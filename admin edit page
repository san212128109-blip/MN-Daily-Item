<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Edit Product - Admin</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <main style="max-width:720px;margin:20px auto;background:white;padding:20px;border-radius:8px;">
    <h2>Edit Product</h2>
    <form id="editForm" enctype="multipart/form-data">
      <input name="title" placeholder="Title" required />
      <textarea name="desc" placeholder="Description"></textarea>
      <input name="price" type="number" step="0.01" placeholder="Price" required />
      <input name="category" placeholder="Category" />
      <input name="image" type="file" accept="image/*" />
      <button type="submit">Save</button>
    </form>
    <p><a href="/admin.html">Back to Admin</a></p>
  </main>

  <script>
    const params = new URLSearchParams(location.search);
    const id = params.get('id');

    async function load(){
      const res = await fetch('/api/products/' + id);
      const j = await res.json();
      if(j.error){ alert(j.error); return; }
      const p = j.product;
      const f = document.getElementById('editForm');
      f.title.value = p.title;
      f.desc.value = p.desc || '';
      f.price.value = p.price;
      f.category.value = p.category;
    }

    document.getElementById('editForm').addEventListener('submit', async e => {
      e.preventDefault();
      const fd = new FormData(e.target);
      const res = await fetch('/api/admin/products/' + id, { method: 'POST', body: fd });
      const j = await res.json();
      if(j.error) alert(j.error); else { alert('Saved'); location.href='/admin.html'; }
    });

    if(id) load();
    else { alert('Missing id'); location.href='/admin.html'; }
  </script>
</body>
</html>
